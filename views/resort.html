<!DOCTYPE html>
<html>
<head>
  <title>Resort</title>
  <%include commonHeadElements.html%>
  <link rel="stylesheet" type="text/css" href="/static/styles/newresort.css">
  <link rel="stylesheet" type="text/css" href="/static/styles/Search.css">
  <link rel="stylesheet" type="text/css" href="/static/styles/stylebookings.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/css/bootstrap-timepicker.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.css"/>
<script type="text/javascript" src="/static/scripts/moment.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js">
</script>
</head>

<body>
<% include header.html %>
<div class="row" style="background-image: url(/static/images/resort.png);background-position: center;padding: 50px  100px;margin-left: 0;margin-right: 0 ">
  <div class="col-md-2 col-sm-2 col-xs-12"></div>
  <div class="col-md-5 col-sm-5 col-xs-12" >
    <div style="text-align: right; color:white">
    
      <h2 class="heading" style="text-align: right;font-weight: bold"><%=bookings[0].rname%> </h2>
      <h4 class="tagline"><%=bookings[0].tagline%></h4>
      <% var ratings= bookings[0].rating %>
      <% for(var j=0;j<ratings;j++){ %>
        <span class="glyphicon glyphicon-star"></span>
      <% } %>
      <p class="small-heading"><i class="material-icons">room</i><%=bookings[0].resortaddress%></p>
      <% if(!currentUser || currentUser.rolename!='admin'){ %>
      <a href="#calendar">
        <button class="btn-main btn-book">Book Now</button>
      </a>
      <% } %>
      <% if(currentUser && currentUser.rolename=='admin'){ %>
      <a href="/app/admin/resort/<%= bookings[0].rid %>/update"><button class="btn-main btn-book">Update</button></a>
      <a href="/app/admin/resort/<%= bookings[0].rid %>/remove"><button class="btn-main btn-book">Remove</button></a>
      <% } %>
    </div>
  </div>
  <div class="col-md-3 col-sm-3 col-xs-12"></div>  
</div>

<div class="container" >
  <div class="row" id="main">
    <div  class="col-md-7 col-sm-7 col-xs-12" style="min-height: 400px">
    
      <h3 class="heading">Description</h3>
      <p><span style="font-weight:bold">Location : </span> <%=bookings[0].loc%> </p>
      <p><span style="font-weight:bold">Number Of Halls :</span>  <%=bookings[0].nhalls%> </p>
      <p ><span style="font-weight:bold">Description :</span><%=bookings[0].description%></p>
      <p><span style="font-weight: bold">Facilities :</span></p>
      <p>
      <% if(bookings[0].ac==1){ %>
        <span class="label label-danger">AC</span>
        <% } %>
        <% if(bookings[0].parking==1){ %>
        <span class="label label-danger">Parking Area</span>
        <% } %>
        <% if(bookings[0].wifi==1){ %>
        <span class="label label-danger">WiFi</span>
        <% } %>
        <% if(bookings[0].DJ==1){ %>
        <span class="label label-danger">DJ & music</span>
        <% } %>
        <% if(bookings[0].nonveg==1){ %>
        <span class="label label-danger">Non-veg</span>
        <% } %>
        <% if(bookings[0].liquor==1){ %>
        <span class="label label-danger">Liquor License</span>
        <% } %>
        <% if(bookings[0].flowerdecor==1){ %>
        <span class="label label-danger">Flower Decorations</span>
        <% } %>
        <% if(bookings[0].catering==1){ %>
        <span class="label label-danger">In-House Catering</span>
        <% } %>
        <% if(bookings[0].rooms==1){ %>
         <span class="label label-danger">Rooms for Stay</span>
         <% } %>
      </p>
    </div>
    <div class="col-md-5 col-sm-5 col-xs-12">
      <h3 style="text-align: center;">Click on any Date to See Halls</h3>
      <div id="calendar"></div>
    </div>
  </div>
  <div class="row" id="main">  
    <div class="col-md-5 col-sm-5 col-xs-12" style="min-width: 40%;min-height: 400px" >
      <h3 class="heading">Portfolio</h3>
      <% if(mediaresult[0]){ %>
      <div id="myCarousel" class="carousel slide" data-ride="carousel" >
  <!-- Indicators -->
        <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        </ol>

  <!-- Wrapper for slides -->
        <div class="carousel-inner">
    <div class="item active">
      <img src="<%=mediaresult[0].url %>" alt="<%=mediaresult[0].url%>">
    </div>

<% if(mediaresult[1]){ %>
    <div class="item">
      <img src="<%=mediaresult[1].url %>" alt="<%=mediaresult[0].url%>">
    </div>
<% } %>
<% if(mediaresult[2]){ %>
    <div class="item">
      <img src="<%=mediaresult[2].url %>" alt="<%=mediaresult[0].url%>">
    </div>
    <% } %>
  </div>

  <!-- Left and right controls -->
  <a class="left carousel-control" href="#myCarousel" data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control" href="#myCarousel" data-slide="next">
    <span class="glyphicon glyphicon-chevron-right"></span>
    <span class="sr-only">Next</span>
  </a>
</div>

</div>
<% } %>


<div class="col-md-7 col-sm-7 col-xs-12" style="height: auto">



 <div class="col-md-8 col-sm-8 col-xm-8" style="margin-top: 2%">
 
<h3 style="font-family: 'Josefin Sans',sans-serif;text-align: right;margin-bottom: 10%" id="availableHalls">Available Halls on <%= utils.formatDate(dt) %></h3>
</div>
<form id="bookingform" style="display: inline;" action="/app/confirmmybooking" method="post">
</form>
<div class="row">
 <div class="col-md-6 col-ms-6">
<h4>Start Time</h4>
<div class="input-group bootstrap-timepicker timepicker">
            <input id="timepicker1" type="text" class="form-control input-small" name="startTime">
            <span class="input-group-addon"><i class="glyphicon glyphicon-time" ></i></span>
        </div></div>
<div class="col-md-6 col-ms-6">
<h4>End Time</h4>
<div class="input-group bootstrap-timepicker timepicker">
            <input id="timepicker2" type="text" class="form-control input-small" name="endTime">
            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
        </div>

</div>
 
</div>

<% var count=0 %>
<%for(var i in hallinfo){%>
<% count++ %>
<div id ="hall_card_<%=i%>" class="card">
  <div class="card-area">
    <div class="row">
      <div class="col-md-4 col-sm-4 col-xs-4" id="hallimage">
        <img src="<%= hallinfo[i].url %>" alt="<%= hallinfo[i].hname %>" width="200px">
      </div>
      <div class="col-md-8 col-sm-8 col-xs-8" id="halldetails">
        <p><span class="card-area-heading">Name :</span><%= hallinfo[i].hname %></p>
        <p><span class="card-area-heading">Capacity :</span><%= hallinfo[i].capacity %></p>
        <p><span class="card-area-heading">Cost :</span><%= hallinfo[i].cost %></p>
        <input type="number" name="hallid" id="hall_id" style="display: none" value="<%= hallinfo[i].hallid %>">
<input type="hidden" name="datetobook" id="datetobook" style="display: none" value="<%=dt %>">
        <% if(!currentUser || currentUser.rolename!='admin'){ %>
        <button class="btn-main btn-imp pull-right book_btn" id="book_btn_<%=i%>">Book Now</button>
        <% } %>
      </div>
    </div>
  </div>
  
</div>


<%}%>
<% if(count==0){ %>
<div class="card">
  <p> Oops!! No halls available here on above date.</p>
</div>
<% } %>
</div>




</div>




<div class="row"  id="main">
<div class="col-md-5 col-sm-5 col-xs-12">
<h3 class="heading">Location :</h3>
<div id="map" style="width:100%;height:300px; ">
</div>
</div>
<div class="col-md-7 col-sm-7 col-xs-12">

<div class="card" style="min-height: 300px;margin-top: 8%">
<h3 class="heading">Terms & Conditions </h3>
  <div class="card-area cancel">
   <p> <%= bookings[0].termsconditions %></p>
  </div>
</div>


</div>

 
</div>
</div>
</div>






<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/js/bootstrap-timepicker.min.js">
</script>
<script type="text/javascript">
 $('#timepicker1').timepicker();
 $('#timepicker2').timepicker();
</script>




<script type="text/javascript">
function getDefaultDate(){
  var tmp = window.location.search;
  console.log(tmp);
  if(tmp){
   
    $('html,body').animate({scrollTop: $("#availableHalls").offset().top,
                            easing : 'swing'
                          });
     var search_date = tmp.split("=")[1];
    console.log(search_date);
    return search_date;  
  }
  else{
    return Date.now();
  }
  
}

$(document).ready(function() {

    // page is now ready, initialize the calendar...

    $('#calendar').fullCalendar({
        
        defaultDate: moment(getDefaultDate()),

        dayClick: function(date, jsEvent, view) {
//alert(document.URL);
        
   window.location.href ="/app/resort/<%=bookings[0].rid%>?date="+date.format();
    
    }
  });

    //var booking_object={};
    $(document).on('click','.book_btn',function(event){
        m=(event.target);
        var num = $(m).attr('id').split('_')[2];
        var current_div = $('#hall_card_'+num);
        console.log($('#timepicker1').val());
        var bookingform = $("#bookingform");
        
        
        $('<input>').attr({
            type: 'hidden',
            id: 'timepicker1',
            name: 'startTime',
            value:$('#timepicker1').val()
        }).appendTo(bookingform);
        
        $('<input>').attr({
            type: 'hidden',
            id: 'timepicker2',
            name: 'endTime',
            value:$('#timepicker2').val()
        }).appendTo(bookingform);
        $('<input>').attr({
            type: 'hidden',
            id: 'hallid',
            name: 'hallid',
            value:current_div.find('#hall_id').val()
        }).appendTo(bookingform);

        $('<input>').attr({
            type: 'hidden',
            id: 'datetobook',
            name: 'datetobook',
            value: current_div.find("#datetobook").val()
        }).appendTo(bookingform);
        var startTime=$('#timepicker1').val();
        var endTime=$('#timepicker2').val();
        
        
       
        if($('#timepicker1').val()!=$('#timepicker2').val()){
          bookingform.submit();
        }
        if($('#timepicker1').val()==$('#timepicker2').val()){
          alert('Start time and End time are same!!');
          window.location.reload(true);
        }
        
         
        
        

        // $.ajax({
        //   type: "POST",
        //   url: "/app/confirmmybooking",
        //   data: booking_object,
        //   success: function(res){
        //     console.log(res);
        //   },
        //   dataType: "json",
        //   contentType : "application/json"
        // });
    });


});


</script>

<script>
function myMap() {
  var mapCanvas = document.getElementById("map");
  var mapOptions = {
    center: new google.maps.LatLng(51.5, -0.2), zoom: 10
  };
  var map = new google.maps.Map(mapCanvas, mapOptions);
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBapq5xyfdndROzIOT4XjgUdnyrS_nOO3Y&callback=myMap"></script>

<%include footer.html%>

</body>

</html>